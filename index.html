<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      position: relative;
    }

    .container {
      width: 100%;
      max-width: 500px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      text-align: center;
    }

    #logo {
      width: clamp(80px, 15vw, 140px);
      height: auto;
      margin-bottom: 1rem;
      border-radius: 10px;
    }

    h1 {
      font-size: clamp(1.2rem, 4vw, 1.8rem);
      margin-bottom: 1.5rem;
      color: #333;
      font-weight: 600;
      line-height: 1.3;
    }

    #reader {
      width: 100%;
      max-width: 320px;
      aspect-ratio: 1;
      margin: 0 auto 1.5rem;
      border-radius: 16px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.15);
      border: 4px solid #e0e0e0;
      position: relative;
    }

    /* Mirror the video inside the reader */
    #reader video {
      /* transform: scaleX(-1); */ /* Ø§Ø­Ø°Ù Ø£Ùˆ Ø¹Ø·Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø·Ø¨ÙŠØ¹ÙŠ */
    }

    #message {
      margin-top: 1rem;
      font-size: clamp(0.9rem, 3vw, 1.1rem);
      color: #fff;
      padding: 0.75rem 1rem;
      border-radius: 12px;
      display: none;
      background: linear-gradient(45deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      transition: all 0.3s ease;
      word-break: break-word;
    }

    #message.error {
      background: linear-gradient(45deg, #dc3545, #e74c3c);
      box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }

    #message.show {
      display: block;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    #settingsBtn {
      position: fixed;
      top: 1rem;
      left: 1rem;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      z-index: 100;
    }

    #settingsBtn:hover {
      transform: rotate(90deg) scale(1.1);
      background: rgba(255, 255, 255, 1);
    }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    #settingsOverlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }

    .settingsModal {
      background: #fff;
      padding: 2rem;
      border-radius: 20px;
      width: 100%;
      max-width: 400px;
      text-align: right;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: modalSlide 0.3s ease-out;
    }

    @keyframes modalSlide {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .settingsModal h3 {
      margin-bottom: 1.5rem;
      color: #333;
      font-size: 1.3rem;
    }

    .settingsModal label {
      font-weight: 600;
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      color: #555;
    }

    .settingsModal input {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .settingsModal input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }

    .buttonGroup {
      display: flex;
      gap: 0.75rem;
      margin-top: 2rem;
      justify-content: flex-start;
    }

    .settingsModal button {
      flex: 1;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .settingsModal button.save {
      background: linear-gradient(45deg, #007bff, #0056b3);
      color: white;
    }

    .settingsModal button.save:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
    }

    .settingsModal button.cancel {
      background: #f8f9fa;
      color: #6c757d;
      border: 2px solid #e9ecef;
    }

    .settingsModal button.cancel:hover {
      background: #e9ecef;
      transform: translateY(-2px);
    }

    /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 480px) {
      body {
        padding: 0.5rem;
      }

      .container {
        padding: 1.5rem;
        border-radius: 15px;
      }

      #settingsBtn {
        width: 45px;
        height: 45px;
        font-size: 1.3rem;
        top: 0.5rem;
        left: 0.5rem;
      }

      .settingsModal {
        padding: 1.5rem;
        border-radius: 15px;
      }

      .buttonGroup {
        flex-direction: column;
      }

      .settingsModal button {
        padding: 1rem;
      }
    }

    /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© */
    @media (min-width: 481px) and (max-width: 768px) {
      .container {
        max-width: 450px;
      }

      #reader {
        max-width: 280px;
      }
    }

    /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
    @media (min-width: 769px) {
      .container {
        max-width: 500px;
      }

      #reader {
        max-width: 320px;
      }
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
    @media (max-height: 500px) and (orientation: landscape) {
      body {
        justify-content: flex-start;
        padding-top: 1rem;
      }

      .container {
        padding: 1rem;
      }

      h1 {
        margin-bottom: 1rem;
        font-size: 1.2rem;
      }

      #reader {
        max-width: 250px;
        margin-bottom: 1rem;
      }
    }

    /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
    .status-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #28a745;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>

  
  <div class="container">
    <img src="logo.JPG" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¤Ø³Ø³Ø©" id="logo">
    <h1>Ø³Ø¬Ù‘Ù„ Ø­Ø¶ÙˆØ±Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙŠÙˆ Ø¢Ø± ÙƒÙˆØ¯</h1>
    
    <div id="reader">
      <div class="status-indicator"></div>
    </div>
    
    <div id="message" role="alert"></div>
  </div>

  <audio id="success-sound" src="you.mp3" preload="auto"></audio>



  <script>
    const message = document.getElementById('message');
    const successSound = document.getElementById('success-sound');
    const settingsOverlay = document.getElementById('settingsOverlay');

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø«Ø§Ø¨ØªØ© Ù„Ù„ÙÙˆØ±Ù… ÙˆØ§Ù„Ù€ entry
  const getFormURL = () => 'https://docs.google.com/forms/d/e/1FAIpQLSfB7FDeyAMlSNN-OHuuD9Fsxsh5opDOdT9vEivWvfe1LlK2DA/viewform?usp=pp_url&entry.1999451295=';

let lastScanned = '';
let canScan = true;
let scanTimeout;
let html5QrCode = null; // Ù…ØªØºÙŠØ± Ø¹Ø§Ù… Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
const scannedCodes = new Set(); // Ø­ÙØ¸ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©

    const showMessage = (text, isError = false, duration = 3000) => {
      clearTimeout(scanTimeout);
      message.style.display = 'block'; // Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹
      message.innerText = text;
      message.className = isError ? 'error show' : 'show';

      scanTimeout = setTimeout(() => {
        message.classList.remove('show');
        setTimeout(() => {
          message.style.display = 'none';
        }, 300);
      }, duration);
    };

    // Ø¯Ø§Ù„Ø© Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¹ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function stopCamera() {
      if (html5QrCode) {
        html5QrCode.stop().catch(() => {});
      }
      // Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
      document.getElementById('reader').style.display = 'none';
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function startCamera(callback) {
      if (!html5QrCode) return;
      const config = {
        fps: 10,
        qrbox: { width: 200, height: 200 },
        aspectRatio: 1.0,
        disableFlip: false
      };
      // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
      document.getElementById('reader').style.display = '';
      Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length) {
          const cameraId = devices.find(device =>
            device.label.toLowerCase().includes('back') ||
            device.label.toLowerCase().includes('rear')
          )?.id || devices[0].id;
          html5QrCode.start(
            cameraId,
            config,
            (decodedText) => {
              // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù‡Ùˆ Ù†ÙØ³Ù‡ Ø¢Ø®Ø± ÙƒÙˆØ¯
              if (decodedText && decodedText === lastScanned) {
                showMessage("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ù„Ù‚Ø§Ø¹Ø©", false, 5000);
                return;
              }
              callback(decodedText);
            }
          ).catch(() => {});
        }
      });
    }

    const qrCodeSuccessCallback = (decodedText) => {
      if (!decodedText) return;

      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©
      if (scannedCodes.has(decodedText)) {
        showMessage("âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ù„Ù‚Ø§Ø¹Ø© ÙˆØªØ±Ùƒ Ø§Ù„Ù…Ø¬Ø§Ù„ Ù„ØºÙŠØ±Ùƒ Ù„Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯.", false, 4000);
        return;
      }

      if (decodedText !== lastScanned && canScan) {
        lastScanned = decodedText;
        canScan = false;
        scannedCodes.add(decodedText); // Ø£Ø¶Ù Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©

        // Ø£ÙˆÙ‚Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙˆØ±Ø§Ù‹
        stopCamera();


        showMessage(`â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...`, false, 1000);

        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯
        const url = getFormURL() + encodeURIComponent(decodedText);
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø¯ÙˆÙ† Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
        fetch(url, { method: 'GET', mode: 'no-cors' });
        console.log(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„ÙƒÙˆØ¯: ${url}`);
        try {
          successSound.play().catch(() => {});
        } catch (e) {}
        // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù…Ø¯Ø© 5 Ø«ÙˆØ§Ù†ÙŠ
        showMessage(`ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­\nØ§Ù„ÙƒÙˆØ¯: ${decodedText}`, false, 5000);

        // Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
          lastScanned = '';
          canScan = true;
          startCamera(qrCodeSuccessCallback);
        }, 5000);
      } else if (decodedText === lastScanned && !canScan) {
        showMessage("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ù„Ù‚Ø§Ø¹Ø© ÙˆØªØ±Ùƒ Ø§Ù„Ù…Ø¬Ø§Ù„ Ù„ØºÙŠØ±Ùƒ Ù„Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯.", false, 4000);
      }
    };

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    const initializeCamera = () => {
      html5QrCode = new Html5Qrcode("reader");
      startCamera(qrCodeSuccessCallback);
    };



    // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('load', () => {
      setTimeout(initializeCamera, 500);
    });

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        setTimeout(() => {
          canScan = true;
          lastScanned = '';
        }, 1000);
      }
    });
  </script>

</body>
</html>